<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infográfico: Eficácia de Ferramentas Antifraude</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF and html2canvas for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Estilos personalizados para o tema Black & Purple */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        .text-glow {
            text-shadow: 0 0 8px rgba(192, 132, 252, 0.5), 0 0 12px rgba(168, 85, 247, 0.3);
        }
        .card {
            background-color: rgba(31, 41, 55, 0.5); /* bg-gray-800 com transparência */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(75, 85, 99, 0.5);
        }
        .icon-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem; /* w-8 */
            height: 2rem; /* h-8 */
            border-radius: 9999px; /* rounded-full */
            background-color: rgba(75, 85, 99, 0.4); /* bg-gray-700 com transparência */
            margin-right: 0.5rem; /* mr-2 */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .icon-wrapper:hover {
            background-color: rgba(139, 92, 246, 0.4);
        }
        /* Estilos para o Tooltip */
        #tooltip {
            position: absolute;
            display: none;
            background-color: #2d3748; /* bg-gray-800 */
            color: #e2e8f0; /* text-gray-300 */
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #4a5568; /* border-gray-600 */
            z-index: 100;
            width: 240px;
            font-size: 0.8rem;
            line-height: 1.4;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3), 0 4px 6px -2px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        #tooltip.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        #tooltip-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            left: 50%;
            transform: translateX(-50%);
        }
        /* Estilos para o Simulador */
        .risk-gauge {
            width: 160px;
            height: 80px;
            position: relative;
            overflow: hidden;
            border-top-left-radius: 150px;
            border-top-right-radius: 150px;
        }
        .risk-gauge-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(from -90deg at 50% 100%, #10B981, #FBBF24, #EF4444);
            filter: grayscale(0.5) brightness(0.8);
        }
        .risk-gauge-cover {
            position: absolute;
            width: 130px;
            height: 65px;
            background: #1f2937;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border-top-left-radius: 150px;
            border-top-right-radius: 150px;
        }
        .risk-gauge-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 2px;
            height: 70px;
            background: #f9fafb;
            transform-origin: bottom center;
            transition: transform 0.5s ease-in-out;
            box-shadow: 0 0 5px #fff;
        }
        .simulator-option {
            background-color: rgba(55, 65, 81, 0.4);
            border: 1px solid rgba(75, 85, 99, 0.6);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .simulator-option.selected {
            background-color: rgba(139, 92, 246, 0.2);
            border-color: rgba(168, 85, 247, 1);
        }
        .info-icon {
            color: rgba(156, 163, 175, 0.6);
            cursor: pointer;
            transition: color 0.2s;
        }
        .info-icon:hover {
            color: rgba(192, 132, 252, 1);
        }
        .action-button, .compare-button {
            background-color: rgba(139, 92, 246, 0.8);
            border: 1px solid rgba(168, 85, 247, 1);
        }
        .action-button:hover:not(:disabled), .compare-button:hover:not(:disabled) {
             background-color: rgba(168, 85, 247, 1);
        }
        .action-button:disabled, .compare-button:disabled {
            background-color: rgba(75, 85, 99, 0.4);
            cursor: not-allowed;
            opacity: 0.6;
        }
        /* Botões Flutuantes e Modais */
        #floating-buttons {
            position: fixed;
            top: 50%;
            left: 1rem;
            transform: translateY(-50%);
            z-index: 90;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .floating-btn {
            background-color: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.5);
            color: #d1d5db;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .floating-btn:hover {
            background-color: rgba(139, 92, 246, 0.8);
            transform: scale(1.1);
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background-color: #1f2937;
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid #4a5568;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            cursor: pointer;
        }
        .tool-checkbox {
            margin-right: 10px;
        }

        #pdf-customization-section {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background-color: rgba(55, 65, 81, 0.2);
            border-radius: 0.5rem;
        }

        #logo-preview {
            max-width: 100px;
            max-height: 50px;
            margin-top: 10px;
        }
        .tool-item {
            display: flex;
            align-items: flex-start; /* Alinha checkbox e conteúdo no topo */
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .tool-item.selected {
            background-color: rgba(139, 92, 246, 0.1);
        }
        /* Anatomia de um Ataque */
        .timeline {
            display: flex;
            flex-direction: column;
            position: relative;
            margin: 2rem 0;
        }
        .timeline::after {
            content: '';
            position: absolute;
            left: 32px; /* Alinha com o centro do ícone */
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #8B5CF6, #D946EF);
            border-radius: 2px;
        }
        .timeline-item {
            display: flex;
            margin-bottom: 2rem;
            position: relative;
        }
        .timeline-item:last-child {
            margin-bottom: 0;
        }
        .timeline-icon {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 1;
            background-color: #374151; /* bg-gray-700 */
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid #8B5CF6; /* Cor da timeline */
        }
        .timeline-content {
            margin-left: 100px; /* Espaçamento após o ícone */
            padding: 1rem;
            background-color: rgba(55, 65, 81, 0.4);
            border-radius: 0.5rem;
            width: 100%;
        }
        /* Visualizador de Efeito de Rede */
        #network-graph-container {
            position: relative;
            width: 100%;
            min-height: 400px;
        }
        .network-node {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: rgba(75, 85, 99, 0.8);
            border: 1px solid #6b7280;
            color: #d1d5db;
            width: 130px;
            z-index: 10;
        }
        .network-node .info-icon {
            position: absolute;
            top: 4px;
            right: 4px;
        }
        .node-icon {
            margin-bottom: 0.25rem;
        }
        .node-text {
            font-size: 0.75rem;
            text-align: center;
            white-space: nowrap;
        }
        #node-fraud {
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            border-color: #ef4444;
        }
        #node-cpf { top: 15%; left: 30%; transform: translateX(-50%); }
        #node-email { top: 15%; right: 30%; transform: translateX(50%); }
        #node-device { bottom: 15%; left: 10%; }
        #node-address { bottom: 15%; right: 10%; }
        #node-purchase-attempt {
            top: 50%; right: 5%;
            transform: translateY(-50%);
            border-color: #fbbf24;
        }
        #network-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
        }

        /* Animações Deep Dive */
        .bot-mouse, .human-mouse {
            width: 12px; height: 12px;
            background-color: #c4b5fd;
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 8px #c4b5fd;
        }
        .bot-mouse { animation: moveBot 3s linear infinite; }
        .human-mouse { animation: moveHuman 4s ease-in-out infinite; }
        @keyframes moveBot { 0%, 100% { top: 8px; left: 8px; } 50% { top: 112px; left: 112px; } }
        @keyframes moveHuman { 0%, 100% { top: 8px; left: 8px; } 25% { top: 60px; left: 100px; } 50% { top: 112px; left: 70px; } 75% { top: 50px; left: 20px; } }

        .human-touch, .atypical-touch {
            border-radius: 50%;
            background-color: rgba(192, 132, 252, 0.5);
            transition: all 0.5s ease-in-out;
        }
        .human-touch { width: 30px; height: 30px; animation: pulseHuman 2s infinite; }
        .atypical-touch { width: 60px; height: 60px; animation: pulseAtypical 1.5s infinite; }
        @keyframes pulseHuman { 50% { transform: scale(0.9); opacity: 0.7; } }
        @keyframes pulseAtypical { 50% { transform: scale(1.1); opacity: 0.5; } }

        /* Estilos do "Escudo Digital" */
        .shield-meter {
            width: 100%;
            height: 20px;
            background-color: #374151;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 1rem;
        }
        #shield-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #10B981, #34D399);
            transition: width 0.5s ease-in-out;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input { display: none; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 28px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider { background-color: #8B5CF6; }
        input:checked + .toggle-slider:before { transform: translateX(22px); }

    </style>
</head>
<body class="text-gray-200">

    <!-- Botões Flutuantes -->
    <div id="floating-buttons">
        <button id="glossary-btn" class="floating-btn" title="Glossário">
            <i data-lucide="book-open"></i>
        </button>
        <button id="lab-btn" class="floating-btn" title="Laboratório de Biometria">
             <i data-lucide="mouse-pointer-2"></i>
        </button>
        <button id="shield-btn" class="floating-btn" title="Escudo Digital Pessoal">
            <i data-lucide="shield"></i>
        </button>
    </div>

    <!-- Modais -->
    <div id="glossary-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn"><i data-lucide="x"></i></button>
            <h3 class="text-2xl font-bold mb-6 text-purple-300 text-glow">Glossário de Termos</h3>
            <div id="glossary-list" class="space-y-4"></div>
        </div>
    </div>
    
    <div id="lab-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn"><i data-lucide="x"></i></button>
            <h3 class="text-2xl font-bold mb-6 text-purple-300 text-glow">Laboratório de Biometria</h3>
            <div class="space-y-8">
                <div>
                    <h4 class="font-bold text-purple-200">Dinâmica de Digitação</h4>
                    <p class="text-sm text-gray-400 mb-2">Digite no campo abaixo para ver a análise do seu ritmo. Sistemas medem o tempo entre as teclas e a duração de cada pressionamento para criar uma assinatura única.</p>
                    <input type="text" id="typing-input" class="w-full p-2 bg-gray-900/70 border border-gray-600 rounded-lg" placeholder="Digite aqui para testar...">
                    <div class="h-40 mt-2"><canvas id="typing-chart"></canvas></div>
                </div>
                <div>
                    <h4 class="font-bold text-purple-200">Movimento do Mouse</h4>
                    <p class="text-sm text-gray-400 mb-2">Mova o mouse (ou o dedo) sobre a área abaixo para ver sua trajetória. Movimentos humanos são curvos, enquanto bots são retilíneos.</p>
                    <div class="relative w-full h-40 bg-gray-900/50 rounded-lg">
                        <canvas id="mouse-canvas"></canvas>
                        <div class="absolute inset-0 border border-dashed border-gray-600 pointer-events-none"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="shield-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn"><i data-lucide="x"></i></button>
            <h3 class="text-2xl font-bold mb-6 text-purple-300 text-glow">Guia de Confiança Digital</h3>
            <p class="text-sm text-gray-400 mb-4">Veja como certas práticas impactam a forma como sistemas antifraude avaliam seu comportamento. Ative as boas práticas e aumente seu nível de confiança!</p>
            <div id="shield-checklist" class="space-y-4"></div>
            <div class="mt-6">
                <p class="text-center font-semibold">Seu Nível de Confiança</p>
                <div class="shield-meter">
                    <div id="shield-bar"></div>
                </div>
            </div>
        </div>
    </div>


    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <!-- Cabeçalho -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-purple-400 text-glow mb-2">Análise de Eficácia</h1>
            <h2 class="text-xl md:text-2xl text-gray-300">Ferramentas Antifraude no E-commerce Brasileiro</h2>
            <p class="text-sm text-gray-500 mt-4 max-w-2xl mx-auto">
                <i data-lucide="alert-circle" class="inline-block w-4 h-4 mr-1"></i>
                Dados ilustrativos baseados na sofisticação das tecnologias. Clique nos ícones para ver a descrição de cada método.
            </p>
        </header>

        <!-- Container do Gráfico de Barras -->
        <main class="card rounded-2xl p-6 md:p-8 shadow-2xl shadow-purple-900/20">
            <div id="chart-container" class="space-y-4"></div>
             <div class="mt-6 text-center">
                <button id="compare-tools-button" class="compare-button px-6 py-2 rounded-lg text-white font-semibold transition-all duration-300" disabled>Comparar Selecionadas</button>
            </div>
        </main>
        
        <!-- Seção de Comparativo Dinâmico -->
        <section id="comparison-section" class="card rounded-2xl p-6 md:p-8 shadow-2xl shadow-purple-900/20 mt-12" style="display: none;">
            <h3 class="text-2xl font-bold text-center mb-2 text-purple-300 text-glow">Confronto Direto</h3>
            <p class="text-center text-sm text-gray-400 mb-6">Análise comparativa das ferramentas selecionadas em métricas específicas de defesa.</p>
            <div class="h-96 md:h-[450px]">
                <canvas id="comparison-radar-chart"></canvas>
            </div>
        </section>
        
        <!-- Anatomia de um Ataque -->
        <section class="card rounded-2xl p-6 md:p-8 shadow-2xl shadow-purple-900/20 mt-12">
            <h3 class="text-2xl font-bold text-center mb-2 text-purple-300 text-glow">Anatomia de uma Tentativa de Fraude</h3>
            <p class="text-center text-sm text-gray-400 mb-6">Uma visualização passo a passo de como uma fraude comum ocorre e como as tecnologias de defesa atuam.</p>
            <div class="timeline">
                <!-- Passo 1: Simulação -->
                <div class="timeline-item">
                    <div class="timeline-icon">
                        <i data-lucide="bot" class="w-8 h-8 text-cyan-400"></i>
                    </div>
                    <div class="timeline-content">
                        <h4 class="font-bold text-lg text-purple-300">1. A Simulação</h4>
                        <p class="text-gray-300 mt-1">Já com acesso à conta, o fraudador navega pelo site, adiciona produtos ao carrinho e preenche dados de forma atípica, tentando imitar um cliente real para não levantar suspeitas.</p>
                         <div class="mt-3">
                            <h5 class="text-sm font-semibold text-gray-400 mb-2">Mecanismo de Defesas:</h5>
                            <div class="flex flex-wrap gap-2">
                                <div class="icon-wrapper" data-tooltip-text="<strong>Biometria Comportamental:</strong> Analisa o ritmo de digitação e os movimentos do mouse, que são diferentes dos do usuário legítimo e podem indicar automação.">
                                    <i data-lucide="mouse-pointer-2" class="w-4 h-4 text-purple-300"></i>
                                </div>
                                 <div class="icon-wrapper" data-tooltip-text="<strong>Biometria de Dispositivo:</strong> Identifica que o dispositivo é novo e nunca foi associado a esta conta.">
                                    <i data-lucide="smartphone" class="w-4 h-4 text-purple-300"></i>
                                </div>
                                 <div class="icon-wrapper" data-tooltip-text="<strong>Análise de Rede e Localização:</strong> Detecta o uso de VPN/Proxy e a inconsistência entre o IP e a localização usual do cliente.">
                                    <i data-lucide="globe-2" class="w-4 h-4 text-purple-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Passo 2: O Golpe -->
                <div class="timeline-item">
                    <div class="timeline-icon">
                        <i data-lucide="shopping-cart" class="w-8 h-8 text-green-400"></i>
                    </div>
                    <div class="timeline-content">
                        <h4 class="font-bold text-lg text-purple-300">2. A Tentativa de Golpe</h4>
                        <p class="text-gray-300 mt-1">A compra é realizada, geralmente com um cartão de crédito diferente do usual e para um endereço de entrega novo, visando produtos de alto valor.</p>
                         <div class="mt-3">
                            <h5 class="text-sm font-semibold text-gray-400 mb-2">Mecanismo de Defesas:</h5>
                            <div class="flex flex-wrap gap-2">
                                <div class="icon-wrapper" data-tooltip-text="<strong>Análise Transacional:</strong> Detecta a divergência entre os dados da compra (novo cartão, novo endereço) e o histórico do cliente.">
                                    <i data-lucide="credit-card" class="w-4 h-4 text-purple-300"></i>
                                </div>
                                <div class="icon-wrapper" data-tooltip-text="<strong>Efeito de Rede:</strong> Se o cartão ou o endereço de entrega já foram usados em fraudes anteriores em outras lojas, o sistema emite um alerta de altíssimo risco.">
                                    <i data-lucide="network" class="w-4 h-4 text-purple-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
             <!-- Caixa de Resumo -->
            <div class="mt-8 p-4 border-2 border-dashed border-purple-800/50 rounded-lg">
                <h4 class="font-bold text-lg text-center text-purple-300">O Veredito do Sistema</h4>
                <p class="text-center text-gray-300 mt-2">O sistema antifraude combina todos os sinais de risco detectados: o dispositivo novo, o comportamento de navegação suspeito e os dados de transação inconsistentes. Essa combinação gera um score de risco altíssimo, levando ao bloqueio imediato da transação antes que a cobrança seja efetivada, protegendo tanto o cliente quanto a loja.</p>
            </div>
        </section>

        <!-- Visualizador de Efeito de Rede -->
        <section class="card rounded-2xl p-6 md:p-8 shadow-2xl shadow-purple-900/20 mt-12">
            <h3 class="text-2xl font-bold text-center mb-2 text-purple-300 text-glow">Visualizador de Efeito de Rede</h3>
            <p class="text-center text-sm text-gray-400 mb-6">Este gráfico demonstra a "Trilha da Fraude". O sistema identifica que o e-mail de uma nova tentativa de compra já está ligado a um CPF, que por sua vez está ligado a um dispositivo e endereço usados em uma fraude anterior. Essa cadeia de evidências conecta o novo pedido à fraude confirmada, disparando um alerta de alto risco.</p>
            <div id="network-graph-container">
                <svg id="network-svg"></svg>
                <!-- Nós -->
                <div id="node-fraud" class="network-node">
                    <i data-lucide="skull" class="node-icon w-6 h-6 text-red-500"></i>
                    <span class="node-text">Fraude Confirmada</span>
                     <i data-lucide="info" class="info-icon" data-tooltip-text="O ponto central da fraude, ao qual todos os dados suspeitos estão, direta ou indiretamente, conectados."></i>
                </div>
                <div id="node-cpf" class="network-node">
                    <i data-lucide="user-x" class="node-icon w-5 h-5 text-gray-300"></i>
                    <span class="node-text">CPF: ***.123.***-**</span>
                     <i data-lucide="info" class="info-icon" data-tooltip-text="<strong>Alerta Vermelho:</strong> Este CPF já foi utilizado em fraudes confirmadas anteriormente na rede."></i>
                </div>
                <div id="node-email" class="network-node">
                     <i data-lucide="mail-x" class="node-icon w-5 h-5 text-gray-300"></i>
                    <span class="node-text">email@fraude.com</span>
                     <i data-lucide="info" class="info-icon" data-tooltip-text="O e-mail utilizado na tentativa de compra. Está diretamente ligado ao CPF fraudulento."></i>
                </div>
                 <div id="node-device" class="network-node">
                    <i data-lucide="smartphone-off" class="node-icon w-5 h-5 text-gray-300"></i>
                    <span class="node-text">Device ID: XXX-123</span>
                    <i data-lucide="info" class="info-icon" data-tooltip-text="Um dispositivo novo, nunca antes visto na rede. Aumenta a suspeita quando combinado com outros fatores de risco."></i>
                </div>
                <div id="node-address" class="network-node">
                    <i data-lucide="map-pin-off" class="node-icon w-5 h-5 text-gray-300"></i>
                    <span class="node-text">Endereço Y</span>
                     <i data-lucide="info" class="info-icon" data-tooltip-text="Endereço de entrega novo e sem histórico. A legitimidade é desconhecida."></i>
                </div>
                 <div id="node-purchase-attempt" class="network-node">
                    <i data-lucide="shopping-cart" class="node-icon w-6 h-6 text-amber-400"></i>
                    <span class="node-text">Tentativa de Compra</span>
                     <i data-lucide="info" class="info-icon" data-tooltip-text="A nova transação que está sendo analisada, utilizando o e-mail ligado à rede de fraude."></i>
                </div>
            </div>
        </section>

        <!-- Gráfico Radar de Fraudes por Estado -->
        <section class="card rounded-2xl p-6 md:p-8 shadow-2xl shadow-purple-900/20 mt-12">
            <h3 class="text-2xl font-bold text-center mb-2 text-purple-300 text-glow">Distribuição de Tentativas de Fraude por Estado</h3>
            <p class="text-center text-sm text-gray-400 mb-6">Gráfico radar ilustrando os estados com maiores índices de tentativas de fraude, em uma escala de 0 a 100%.</p>
            <div class="h-96 md:h-[450px]">
                <canvas id="state-fraud-radar-chart"></canvas>
            </div>
        </section>

        <!-- Container do Gráfico de Linhas -->
        <section class="card rounded-2xl p-6 md:p-8 shadow-2xl shadow-purple-900/20 mt-12">
            <h3 class="text-2xl font-bold text-center mb-2 text-purple-300 text-glow">Análise de Proximidade e Tecnologias-Chave</h3>
            <p class="text-center text-sm text-gray-400 mb-6">Visualização da proximidade à eficácia de 100% e as tecnologias que impulsionam essa precisão.</p>
            <div class="relative h-96">
                 <canvas id="line-chart"></canvas>
            </div>
        </section>

        <!-- Container do Gráfico de Radar de Vulnerabilidade -->
        <section class="card rounded-2xl p-6 md:p-8 shadow-2xl shadow-purple-900/20 mt-12">
            <h3 class="text-2xl font-bold text-center mb-2 text-purple-300 text-glow">Análise de Precisão vs. Vulnerabilidade</h3>
            <p class="text-center text-sm text-gray-400 mb-6">Comparativo entre a alta precisão e os pontos fracos de cada ferramenta. As ferramentas estão ordenadas pela maior vulnerabilidade.</p>
            <div class="h-96 md:h-[450px]">
                 <canvas id="radar-chart"></canvas>
            </div>
        </section>

        <!-- Simulador de Score de Risco -->
        <section class="card rounded-2xl p-6 md:p-8 shadow-2xl shadow-purple-900/20 mt-12" id="simulator-section">
            <h3 class="text-2xl font-bold text-center mb-2 text-purple-300 text-glow">Simulador de Score de Risco</h3>
            <p class="text-center text-sm text-gray-400 mb-6">Selecione os fatores de uma transação hipotética para calcular o score de risco com base em uma análise multifatorial.</p>
            
            <div class="flex flex-col md:flex-row gap-8">
                <!-- Painel de Resultados -->
                <div class="w-full md:w-2/5 flex flex-col items-center">
                    <!-- Div para exportar para o PDF -->
                    <div id="pdf-export-content" class="bg-gray-800/50 p-4 rounded-xl w-full">
                        <div id="pdf-header" class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-bold text-purple-300">Relatório de Risco</h4>
                            <img id="logo-preview" src="" alt="Logo" class="hidden">
                        </div>
                        <div class="flex gap-4 items-center">
                            <div id="gauge-container" class="relative flex flex-col items-center mb-4">
                                <div class="risk-gauge">
                                    <div class="risk-gauge-bg"></div>
                                    <div id="risk-needle" class="risk-gauge-needle" style="transform: rotate(0deg);"></div>
                                    <div class="risk-gauge-cover"></div>
                                </div>
                                <div id="risk-score-text" class="absolute bottom-1 text-3xl font-bold text-glow transition-colors duration-500">50</div>
                            </div>
                            <div id="risk-verdict" class="text-xl font-bold text-center transition-colors duration-500">Risco Médio</div>
                        </div>
                        <div class="h-48 mt-2">
                             <canvas id="influence-chart"></canvas>
                        </div>
                    </div>
                    
                    <div id="ai-analysis-container" class="w-full text-xs text-gray-300 mt-4 p-3 bg-gray-900/50 rounded-lg border border-purple-800/50" style="display: none;"></div>
                    
                    <!-- Seção de Customização do PDF -->
                    <div id="pdf-customization-section" style="display: none;">
                        <h4 class="font-semibold text-lg my-2 text-purple-200">Personalizar Relatório PDF</h4>
                        <div>
                            <label for="logo-upload" class="block mb-1 text-sm font-medium">Logo da Empresa (Opcional):</label>
                            <input type="file" id="logo-upload" accept="image/png, image/jpeg" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-500 file:text-white hover:file:bg-purple-600"/>
                        </div>
                         <div class="mt-4">
                            <label for="pdf-notes" class="block mb-1 text-sm font-medium">Notas Adicionais:</label>
                            <textarea id="pdf-notes" rows="3" class="w-full p-2 bg-gray-900/70 border border-gray-600 rounded-lg focus:ring-purple-500 focus:border-purple-500"></textarea>
                        </div>
                    </div>
                    
                    <!-- Botões de Ação -->
                    <div class="w-full mt-4 flex flex-col sm:flex-row gap-2">
                         <button id="ai-analysis-button" class="action-button flex-1 p-3 rounded-lg text-white font-semibold transition-all duration-300">
                            Analisar Cenário
                        </button>
                        <button id="export-pdf-button" class="action-button flex-1 p-3 rounded-lg text-white font-semibold transition-all duration-300" disabled>
                            Exportar Análise
                        </button>
                    </div>
                </div>

                <!-- Painel de Opções -->
                <div id="simulator-options" class="w-full md:w-3/5 grid grid-cols-1 xl:grid-cols-2 gap-4">
                    <!-- Grupos de opções serão injetados aqui pelo JS -->
                </div>
            </div>
        </section>

        <!-- Rodapé -->
        <footer id="page-footer" class="text-center mt-12 text-gray-600 text-sm">
            <p>Análise e visualização de dados com base em pesquisa avançada. © 2025. Criado por DATARIS SOLUÇÕES.</p>
        </footer>
    </div>

    <!-- Elemento do Tooltip -->
    <div id="tooltip">
        <div id="tooltip-arrow"></div>
        <p id="tooltip-content"></p>
    </div>

    <script>
        // Estrutura de dados para os gráficos
        const fraudTools = [
            { name: "LexisNexis", rate: 99.5, description: "Biometria física (digitação, mouse, etc.).", icons: ['fingerprint', 'cpu', 'smartphone-charging'], comparisonScores: { bots: 70, friendly: 60, behavioral: 95, network: 30 }, vulnerabilityScore: 4, weaknessDescription: "Vulnerabilidade a ataques de imitação humana.", keyTech: "Foco principal em Biometria Comportamental (dinâmica de digitação, movimento do mouse, interação com o celular)." },
            { name: "Mercado Pago", rate: 99.2, description: "Múltiplas camadas: Big Data, IA, etc.", icons: ['database', 'cpu', 'user-check', 'shield'], comparisonScores: { bots: 90, friendly: 85, behavioral: 75, network: 90 }, vulnerabilityScore: 2, weaknessDescription: "Baixa vulnerabilidade devido à revisão manual.", keyTech: "Combinação de Fatores: Análise de Big Data do ecossistema, Machine Learning e Revisão Manual." },
            { name: "ClearSale", rate: 99.0, description: "Data Lake massivo e 'efeito de rede'.", icons: ['database', 'network', 'cpu', 'sliders-horizontal'], comparisonScores: { bots: 85, friendly: 80, behavioral: 70, network: 95 }, vulnerabilityScore: 3, weaknessDescription: "Desafiado por fraudadores com dados novos.", keyTech: "Combinação de Fatores: Análise de comportamento em um vasto Data Lake, com forte ênfase no 'Efeito de Rede'." },
            { name: "Stripe", rate: 98.8, description: "Machine Learning em rede global.", icons: ['globe', 'cpu', 'credit-card'], comparisonScores: { bots: 95, friendly: 70, behavioral: 50, network: 92 }, vulnerabilityScore: 5, weaknessDescription: "Ponto cego para navegação legítima.", keyTech: "Combinação de Fatores: Machine Learning sobre uma rede global de transações e 'Device Fingerprinting'." },
            { name: "Konduto", rate: 98.6, description: "Navegação e biometria de localização.", icons: ['mouse-pointer-click', 'map-pin', 'cpu'], comparisonScores: { bots: 80, friendly: 75, behavioral: 85, network: 60 }, vulnerabilityScore: 4, weaknessDescription: "Menos eficaz contra 'fraude amiga'.", keyTech: "Foco em Biometria Comportamental (Análise de Navegação) combinada com Biometria de Localização." },
            { name: "PayPal", rate: 98.2, description: "Rede global e device fingerprinting.", icons: ['globe', 'fingerprint', 'shield'], comparisonScores: { bots: 88, friendly: 82, behavioral: 60, network: 85 }, vulnerabilityScore: 6, weaknessDescription: "Risco com dados 100% legítimos.", keyTech: "Combinação de Fatores: Análise de dados transacionais globais e 'Device Fingerprinting'." },
            { name: "EBANX", rate: 97.9, description: "Foco em mercados emergentes com ML.", icons: ['dollar-sign', 'cpu', 'file-cog'], comparisonScores: { bots: 75, friendly: 72, behavioral: 65, network: 70 }, vulnerabilityScore: 7, weaknessDescription: "Suscetível a novos padrões de ataque.", keyTech: "Combinação de Fatores: Machine Learning treinado com dados de pagamentos de mercados emergentes e regras de negócio." },
        ];
        
        const iconMap = {
            'fingerprint': 'fingerprint', 'cpu': 'cpu', 'smartphone-charging': 'smartphone',
            'database': 'database', 'user-check': 'user-check', 'shield': 'shield', 'network': 'network',
            'sliders-horizontal': 'sliders-horizontal', 'globe': 'globe', 'credit-card': 'credit-card',
            'mouse-pointer-click': 'mouse-pointer-2', 'map-pin': 'map-pin', 'dollar-sign': 'dollar-sign',
            'file-cog': 'file-cog',
        };

        const iconDescriptions = {
            'fingerprint': '<strong>Biometria de Dispositivo:</strong> Analisa características únicas de hardware e software do dispositivo para criar uma "impressão digital" e identificar acessos recorrentes.',
            'cpu': '<strong>Inteligência Artificial:</strong> Utiliza algoritmos de Machine Learning para analisar padrões complexos em milhões de dados e prever o risco de fraude em tempo real.',
            'smartphone-charging': '<strong>Interação Mobile:</strong> Avalia como o usuário segura e interage com o dispositivo móvel, incluindo ângulo, pressão do toque e movimentos.',
            'database': '<strong>Big Data / Data Lake:</strong> Processa um volume massivo de dados históricos de transações e comportamentos para enriquecer a análise e identificar tendências.',
            'user-check': '<strong>Revisão Manual:</strong> Em casos de alto risco ou dúvida, especialistas analisam a transação manualmente para uma decisão mais precisa.',
            'shield': '<strong>Múltiplas Camadas/Regras:</strong> Combina diferentes tecnologias de segurança e regras de negócio predefinidas para criar uma defesa robusta e multifacetada.',
            'network': '<strong>Efeito de Rede:</strong> O aprendizado sobre uma tentativa de fraude em um cliente é compartilhado e aplicado instantaneamente para proteger toda a rede de usuários.',
            'sliders-horizontal': '<strong>Fricção Adaptativa:</strong> Ajusta dinamicamente o nível de segurança, solicitando verificações adicionais apenas para transações de maior risco, melhorando a experiência do usuário.',
            'globe': '<strong>Rede Global:</strong> Utiliza dados de uma vasta rede internacional de transações para identificar padrões de fraude e reconhecer dispositivos e cartões em escala global.',
            'credit-card': '<strong>Análise Transacional:</strong> Avalia os detalhes da transação em si, como valor, produtos, frequência e histórico de compras, em busca de anomalias.',
            'mouse-pointer-click': '<strong>Análise de Navegação:</strong> Monitora como o usuário navega pelo site, incluindo movimentos do mouse, cliques e tempo gasto em cada página, para detectar bots.',
            'map-pin': '<strong>Biometria de Localização:</strong> Usa o histórico de geolocalização do dispositivo para validar a identidade do usuário e identificar inconsistências geográficas.',
            'dollar-sign': '<strong>Foco em Pagamentos:</strong> Expertise em processamento de pagamentos, com modelos de risco ajustados às particularidades financeiras de diferentes mercados.',
            'file-cog': '<strong>Regras de Negócio:</strong> Aplica regras customizadas e predefinidas (Hard Rules) para bloquear automaticamente padrões de fraude já conhecidos e inequívocos.'
        };

        const glossaryTerms = {
            'Device Fingerprinting': 'Técnica que cria um identificador único (uma "impressão digital") para um dispositivo com base em suas características de hardware e software. É usada para reconhecer dispositivos que retornam e identificar anomalias.',
            'Efeito de Rede': 'Conceito onde o aprendizado de um sistema antifraude beneficia toda a rede de clientes. Se uma fraude é detectada em uma loja, os dados do fraudador (dispositivo, IP, etc.) são compartilhados para proteger todas as outras lojas da rede instantaneamente.',
            'Chargeback': 'Ocorre quando um cliente contesta uma cobrança em seu cartão de crédito junto ao banco emissor, que reverte a transação. Pode ser legítimo (produto não entregue) ou fraudulento (fraude amigável).',
            'Fraude Amigável': 'Tipo de fraude onde o titular legítimo do cartão faz uma compra, recebe o produto/serviço, e depois alega fraudulentamente que não reconhece a transação para obter um estorno (chargeback).',
            'Account Takeover (ATO)': 'Ataque em que um fraudador obtém acesso não autorizado à conta de um usuário legítimo (por phishing, malware ou vazamento de senhas) para realizar transações fraudulentas.',
            'Biometria Comportamental': 'Análise de padrões únicos na forma como uma pessoa interage com um dispositivo, como ritmo de digitação, movimento do mouse, pressão do toque e maneira de segurar o celular.',
            'Falso Positivo': 'Ocorre quando uma transação legítima é incorretamente classificada como fraudulenta pelo sistema antifraude, resultando no bloqueio indevido de um cliente real.',
            'VPN / Proxy': 'Ferramentas de rede que mascaram o endereço de IP e a localização real de um usuário. São frequentemente usadas por fraudadores para ocultar sua origem.'
        };

        let influenceChart, comparisonChart, typingChart;

        document.addEventListener('DOMContentLoaded', () => {
            renderBarChart();
            renderStateFraudRadarChart();
            renderLineChart();
            renderRadarChart();
            renderSimulator();
            setupModals();
            setupComparison();
            setupLocalAnalysisButton();
            setupExportButton();
            setupNetworkGraph();
            lucide.createIcons();
            setupTooltips();
        });

        // --- FUNÇÕES DOS GRÁFICOS ---
        function renderBarChart() {
            const container = document.getElementById('chart-container');
            fraudTools.forEach((tool, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'tool-item';
                itemDiv.innerHTML = `
                    <input type="checkbox" class="tool-checkbox mt-2 h-5 w-5 rounded bg-gray-700 border-gray-600 text-purple-600 focus:ring-purple-500" data-tool-index="${index}">
                    <div class="ml-4 w-full">
                        <div class="flex flex-col md:flex-row items-start md:items-center w-full">
                            <h3 class="font-semibold text-lg text-gray-100 w-full md:w-1/3">${tool.name}</h3>
                            <div class="w-full md:w-2/3 flex items-center">
                                <div class="w-full bg-gray-700 rounded-full h-4">
                                    <div class="h-4 rounded-full bg-gradient-to-r from-purple-500 to-fuchsia-500" style="width: ${tool.rate}%;"></div>
                                </div>
                                <span class="font-bold text-lg ml-4 text-purple-300 text-glow" style="min-width: 60px;">${tool.rate}%</span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">${tool.description}</p>
                        <div class="flex mt-2">
                            ${tool.icons.map(iconName => `
                                <div class="icon-wrapper" data-tooltip-text="${iconDescriptions[iconName] || ''}">
                                    <i data-lucide="${iconMap[iconName] || 'shield'}" class="w-4 h-4 text-purple-300 pointer-events-none"></i>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(itemDiv);
            });
        }
        
        function renderStateFraudRadarChart() {
            const ctx = document.getElementById('state-fraud-radar-chart').getContext('2d');
            const stateFraudData = [
                { state: "SP", riskIndex: 95 }, { state: "RJ", riskIndex: 92 },
                { state: "DF", riskIndex: 90 }, { state: "BA", riskIndex: 75 },
                { state: "CE", riskIndex: 72 }, { state: "GO", riskIndex: 70 },
                { state: "MG", riskIndex: 68 }, { state: "PR", riskIndex: 65 },
                { state: "PE", riskIndex: 64 }, { state: "RS", riskIndex: 62 },
                { state: "MA", riskIndex: 60 }, { state: "PA", riskIndex: 58 }
            ].sort((a,b) => b.riskIndex - a.riskIndex);

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: stateFraudData.map(d => d.state),
                    datasets: [{
                        label: 'Índice de Tentativas de Fraude (%)',
                        data: stateFraudData.map(d => d.riskIndex),
                        borderColor: 'rgba(239, 68, 68, 1)',
                        backgroundColor: 'rgba(239, 68, 68, 0.4)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(239, 68, 68, 1)',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            angleLines: { color: 'rgba(75, 85, 99, 0.5)' },
                            grid: { color: 'rgba(75, 85, 99, 0.5)' },
                            pointLabels: { color: 'rgba(209, 213, 219, 0.8)', font: { size: 12 } },
                            ticks: {
                                color: 'rgba(209, 213, 219, 0.7)',
                                backdropColor: 'rgba(31, 41, 55, 0.5)',
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            titleColor: '#d1d5db',
                            bodyColor: '#9ca3af',
                            callbacks: {
                                label: (context) => `Índice: ${context.formattedValue}%`
                            }
                        }
                    }
                }
            });
        }

        function renderLineChart() {
            const canvas = document.getElementById('line-chart');
            const ctx = canvas.getContext('2d');
            const sortedTools = [...fraudTools].sort((a, b) => b.rate - a.rate);
            
            const lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedTools.map(t => t.name),
                    datasets: [{
                        label: 'Taxa de Eficácia',
                        data: sortedTools.map(t => t.rate),
                        borderColor: 'rgba(168, 85, 247, 1)',
                        backgroundColor: 'rgba(168, 85, 247, 0.2)',
                        borderWidth: 2, fill: true, tension: 0.4,
                        pointBackgroundColor: 'rgba(192, 132, 252, 1)',
                        pointBorderColor: '#fff', pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(168, 85, 247, 1)'
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        y: { max: 100, min: 97.5, ticks: { color: 'rgba(209, 213, 219, 0.7)' }, grid: { color: 'rgba(75, 85, 99, 0.5)' } },
                        x: { ticks: { color: 'rgba(209, 213, 219, 0.7)' }, grid: { display: false } }
                    },
                    plugins: {
                        legend: { labels: { color: 'rgba(209, 213, 219, 1)' } },
                        tooltip: {
                            backgroundColor: '#1f2937', titleColor: '#d1d5db', bodyColor: '#9ca3af',
                            callbacks: {
                                afterBody: (context) => {
                                    const tool = sortedTools[context[0].dataIndex];
                                    return `\nTecnologia Chave:\n${tool.keyTech}`;
                                }
                            }
                        }
                    }
                }
            });

             canvas.onclick = (evt) => {
                const points = lineChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
                if (points.length) {
                    const firstPoint = points[0];
                    const toolData = sortedTools[firstPoint.index];
                    const content = `<strong>${toolData.name}</strong><br>${toolData.keyTech}`;
                    
                    const tooltip = document.getElementById('tooltip');
                    const tooltipContent = document.getElementById('tooltip-content');

                    if (tooltip.classList.contains('visible') && tooltip.dataset.currentTrigger === canvas) {
                        tooltip.classList.remove('visible');
                        tooltip.dataset.currentTrigger = null;
                        return;
                    }

                    tooltipContent.innerHTML = content;
                    tooltip.classList.add('visible');
                    tooltip.dataset.currentTrigger = canvas; 
                    
                    positionTooltipForChart(evt, tooltip);
                }
            };
        }

        function positionTooltipForChart(evt, tooltip) {
            const rect = evt.target.getBoundingClientRect();
            let left = evt.clientX - rect.left + 15;
            let top = evt.clientY - rect.top + 15;
            
            tooltip.style.left = `${left}px`;
            tooltip.style.top = `${top}px`;
        }


        function renderRadarChart() {
            const ctx = document.getElementById('radar-chart').getContext('2d');
            const radarTools = [...fraudTools].sort((a, b) => b.vulnerabilityScore - a.vulnerabilityScore);
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: radarTools.map(t => t.name),
                    datasets: [
                        {
                            label: 'Precisão (%)',
                            data: radarTools.map(t => t.rate),
                            borderColor: 'rgba(168, 85, 247, 1)',
                            backgroundColor: 'rgba(168, 85, 247, 0.2)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(168, 85, 247, 1)',
                        },
                        {
                            label: 'Índice de Vulnerabilidade',
                            data: radarTools.map(t => t.vulnerabilityScore * 10),
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 0.2)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(239, 68, 68, 1)',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            angleLines: { color: 'rgba(75, 85, 99, 0.5)' },
                            grid: { color: 'rgba(75, 85, 99, 0.5)' },
                            pointLabels: { color: 'rgba(209, 213, 219, 0.8)', font: { size: 10 } },
                            ticks: {
                                color: 'rgba(209, 213, 219, 0.7)',
                                backdropColor: 'rgba(31, 41, 55, 0.5)',
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'rgba(209, 213, 219, 1)' } },
                        tooltip: {
                            backgroundColor: '#1f2937', titleColor: '#d1d5db', bodyColor: '#9ca3af',
                             callbacks: {
                                title: (context) => context[0].label,
                                label: (context) => {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    let value = context.formattedValue;
                                    if(context.dataset.label === 'Precisão (%)') value += '%';
                                    return label + value;
                                },
                                afterBody: (context) => {
                                     const tool = radarTools[context[0].dataIndex];
                                     return `\nPonto Fraco:\n${tool.weaknessDescription}`;
                                 }
                            }
                        }
                    }
                }
            });
        }

        // --- LÓGICA DO SIMULADOR ---
        function renderSimulator() {
            const riskFactors = {
                'Histórico do Usuário': { icon: 'user', options: [
                    { id: 'user-new', text: 'Novo Usuário', score: 15, analysis: 'Sem histórico, a confiança é baixa.', tooltip: 'Primeira interação do cliente com a loja. Não há dados históricos para comparação, aumentando a incerteza.'},
                    { id: 'user-known', text: 'Usuário Conhecido', score: -15, analysis: 'Usuário com histórico positivo.', tooltip: 'Cliente com um histórico de compras legítimas e comportamento consistente, gerando um perfil de confiança.'},
                    { id: 'user-chargeback', text: 'Histórico de Chargeback', score: 35, analysis: 'Alto risco de fraude repetida.', tooltip: 'Cliente já esteve envolvido em contestações de compra (chargebacks), um forte indicador de fraude ou insatisfação recorrente.'},
                ]},
                'Fingerprint do Dispositivo': { icon: 'smartphone', options: [
                    { id: 'device-trusted', text: 'Dispositivo Confiável', score: -20, analysis: 'Dispositivo já associado à conta.', tooltip: 'O dispositivo (computador ou celular) já foi usado em compras anteriores e está vinculado positivamente à conta do cliente.'},
                    { id: 'device-new', text: 'Dispositivo Novo', score: 10, analysis: 'Risco moderado por falta de histórico.', tooltip: "Dispositivo nunca visto antes. Pode ser um cliente legítimo com um aparelho novo, ou um fraudador usando um dispositivo 'limpo'."},
                    { id: 'device-emulator', text: 'Uso de Emulador/VM', score: 40, analysis: 'Altamente suspeito de automação.', tooltip: 'A transação se origina de um software que emula um dispositivo real, uma tática comum para mascarar a identidade e automatizar fraudes em escala.'},
                ]},
                'Rede e Localização': { icon: 'globe-2', options: [
                    { id: 'net-consistent', text: 'Localização Consistente', score: -10, analysis: 'Localização corresponde ao perfil.', tooltip: 'A localização do IP do usuário é compatível com seus endereços de cobrança e entrega, e com seu histórico.'},
                    { id: 'net-vpn', text: 'Uso de VPN/Proxy', score: 25, analysis: 'Tentativa de mascarar a origem.', tooltip: 'Uso de redes privadas (VPN) ou proxies para ocultar a localização real, um comportamento frequentemente associado a atividades fraudulentas.'},
                    { id: 'net-mismatch', text: 'Geolocalização Incompatível', score: 35, analysis: 'IP, entrega e cobrança não batem.', tooltip: 'Inconsistência grave entre a localização física do comprador, o endereço de entrega e o local de emissão do cartão.'},
                ]},
                'Biometria Comportamental': { icon: 'mouse-pointer-2', options: [
                    { id: 'behav-natural', text: 'Comportamento Natural', score: -15, analysis: 'Interação humana e fluida.', tooltip: 'A velocidade de digitação, os movimentos do mouse e a navegação são consistentes com padrões humanos conhecidos.'},
                    { id: 'behav-paste', text: 'Dados Colados / Robóticos', score: 30, analysis: 'Sinal forte de bot ou fraude.', tooltip: 'O usuário cola informações (como nome ou cartão) nos campos em vez de digitar, ou a navegação é rápida e linear demais, indicando automação.'},
                    { id: 'behav-hesitant', text: 'Navegação Hesitante', score: 5, analysis: 'Pode ser novo usuário ou fraude.', tooltip: 'Comportamento muito lento ou errático. Pode indicar um novo usuário se familiarizando com o site ou um fraudador tentando evitar a detecção.'},
                ]},
                 'Dados da Transação': { icon: 'credit-card', options: [
                    { id: 'trans-normal', text: 'Valor e Produto Típicos', score: -10, analysis: 'Compra dentro do padrão.', tooltip: 'O valor da compra e os itens no carrinho são consistentes com o histórico de gastos do cliente.'},
                    { id: 'trans-high', text: 'Valor Muito Acima do Padrão', score: 20, analysis: 'Suspeito de uso de cartão roubado.', tooltip: 'Uma compra de valor muito superior à média do cliente pode indicar que a conta ou o cartão foram comprometidos.'},
                    { id: 'trans-test', text: 'Múltiplas Tentativas Falhas', score: 30, analysis: 'Padrão clássico de teste de cartão.', tooltip: 'Várias tentativas de pagamento com falha em um curto período, sugerindo que um fraudador está testando uma lista de cartões roubados.'},
                ]},
                'Análise do Carrinho e Valor': { icon: 'shopping-cart', options: [
                    { id: 'cart-normal', text: 'Itens e Valor Consistentes', score: -5, analysis: 'Compra alinhada ao perfil de consumo.', tooltip: 'Os produtos e o valor total da compra são coerentes com o que clientes legítimos costumam adquirir.'},
                    { id: 'cart-high-risk', text: 'Produtos de Alto Risco', score: 15, analysis: 'Itens como eletrônicos/jóias são visados.', tooltip: 'O carrinho contém produtos de alto valor e fáceis de revender (ex: celulares, notebooks), que são alvos comuns de fraude.'},
                    { id: 'cart-atypical', text: 'Quantidade Atípica / Revenda', score: 25, analysis: 'Compra em volume sugere revenda fraudulenta.', tooltip: 'Compra de múltiplas unidades do mesmo item de alto valor, indicando possível intenção de revenda de produtos obtidos fraudulentamente.'},
                ]},
                'Dados Cadastrais e Reputação': { icon: 'shield-check', options: [
                    { id: 'data-good', text: 'Dados e Reputação Bons', score: -10, analysis: 'Dados consistentes e sem histórico negativo.', tooltip: 'O e-mail, telefone e endereço do cliente são consistentes e não estão associados a atividades suspeitas.'},
                    { id: 'data-disposable', text: 'Email Descartável/Novo', score: 15, analysis: 'Emails temporários ou muito recentes são suspeitos.', tooltip: 'Uso de um e-mail temporário ou recém-criado, uma tática comum para evitar rastreamento após a fraude.'},
                    { id: 'data-bad-network', text: 'Ligação com Fraude Anterior', score: 50, analysis: 'Dados já associados a fraudes na rede (Efeito de Rede).', tooltip: 'O e-mail, CPF, dispositivo ou outro dado já foi usado em uma fraude confirmada em outra loja da rede, um indicador de altíssimo risco.'},
                ]}
            };
            
            const container = document.getElementById('simulator-options');
            container.innerHTML = '';
            
            for (const category in riskFactors) {
                const group = riskFactors[category];
                let optionsHtml = group.options.map(opt => `
                    <button id="${opt.id}" data-score="${opt.score}" data-analysis="${opt.analysis}" data-category="${category}" class="simulator-option p-3 rounded-lg text-sm min-w-[120px]">
                        <span class="flex-1 text-left mr-2">${opt.text}</span>
                        <i data-lucide="help-circle" class="info-icon w-4 h-4" data-tooltip-text="${opt.tooltip}"></i>
                    </button>
                `).join('');

                const categoryHtml = `
                    <div class="flex flex-col space-y-2">
                        <h4 class="font-semibold text-gray-300 flex items-center"><i data-lucide="${group.icon}" class="w-4 h-4 mr-2 text-purple-300"></i>${category}</h4>
                        <div class="flex gap-2 flex-wrap">${optionsHtml}</div>
                    </div>
                `;
                container.innerHTML += categoryHtml;
            }

            // Adicionar listeners para os botões de opção
            document.querySelectorAll('.simulator-option').forEach(button => {
                button.addEventListener('click', (event) => {
                    // Se o clique foi no ícone de ajuda, não selecione o botão.
                    if (event.target.closest('.info-icon')) {
                        return;
                    }
                    const parent = button.closest('.flex.gap-2.flex-wrap');
                    parent.querySelectorAll('.simulator-option').forEach(b => b.classList.remove('selected'));
                    button.classList.add('selected');
                    calculateRiskScore();
                });
            });
            
            // Set default selections
            document.getElementById('user-new').click();
            document.getElementById('device-new').click();
            document.getElementById('net-consistent').click();
            document.getElementById('behav-hesitant').click();
            document.getElementById('trans-normal').click();
            document.getElementById('cart-normal').click();
            document.getElementById('data-good').click();

            calculateRiskScore();
        }
        
        function calculateRiskScore() {
            let score = 0;
            let selectedFactors = [];
            let categoryScores = {};

            document.querySelectorAll('.simulator-option.selected').forEach(button => {
                const factorScore = parseInt(button.dataset.score);
                const category = button.dataset.category;
                score += factorScore;
                selectedFactors.push({
                    text: button.querySelector('span').textContent.trim(),
                    score: factorScore
                });
                
                if(!categoryScores[category]) {
                    categoryScores[category] = 0;
                }
                categoryScores[category] += factorScore;
            });
            
            score = Math.max(0, Math.min(100, 50 + score));

            updateGauge(score);
            updateInfluenceChart(categoryScores);
            
            document.getElementById('ai-analysis-container').style.display = 'none';
            document.getElementById('pdf-customization-section').style.display = 'none';
            document.getElementById('export-pdf-button').disabled = true;
        }

        function updateGauge(score) {
            const needle = document.getElementById('risk-needle');
            const scoreText = document.getElementById('risk-score-text');
            const verdictText = document.getElementById('risk-verdict');

            const angle = -90 + (score / 100) * 180;
            needle.style.transform = `rotate(${angle}deg)`;
            scoreText.textContent = score;

            if (score <= 35) {
                verdictText.textContent = 'Risco Baixo';
                scoreText.style.color = '#10B981';
                verdictText.style.color = '#10B981';
            } else if (score <= 65) {
                verdictText.textContent = 'Risco Médio';
                scoreText.style.color = '#FBBF24';
                verdictText.style.color = '#FBBF24';
            } else {
                verdictText.textContent = 'Risco Alto';
                scoreText.style.color = '#EF4444';
                verdictText.style.color = '#EF4444';
            }
        }
        
        function updateInfluenceChart(categoryScores) {
            const ctx = document.getElementById('influence-chart').getContext('2d');
            const labels = Object.keys(categoryScores);
            const data = Object.values(categoryScores);

            if (influenceChart) {
                influenceChart.data.labels = labels;
                influenceChart.data.datasets[0].data = data;
                influenceChart.data.datasets[0].backgroundColor = data.map(value => value >= 0 ? 'rgba(239, 68, 68, 0.7)' : 'rgba(16, 185, 129, 0.7)');
                influenceChart.data.datasets[0].borderColor = data.map(value => value >= 0 ? 'rgba(239, 68, 68, 1)' : 'rgba(16, 185, 129, 1)');
                influenceChart.update();
            } else {
                influenceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Influência no Score',
                            data: data,
                            backgroundColor: data.map(value => value >= 0 ? 'rgba(239, 68, 68, 0.7)' : 'rgba(16, 185, 129, 0.7)'),
                            borderColor: data.map(value => value >= 0 ? 'rgba(239, 68, 68, 1)' : 'rgba(16, 185, 129, 1)'),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                ticks: { color: 'rgba(209, 213, 219, 0.7)' },
                                grid: { color: 'rgba(75, 85, 99, 0.5)' }
                            },
                            y: {
                                ticks: { color: 'rgba(209, 213, 219, 0.7)', font: { size: 10 } },
                                grid: { display: false }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Fatores de Influência',
                                color: '#d1d5db',
                                font: { size: 14 }
                            }
                        }
                    }
                });
            }
        }

        // --- LÓGICA DA ANÁLISE LOCAL (OFFLINE) ---
        function setupLocalAnalysisButton() {
            const button = document.getElementById('ai-analysis-button');
            button.addEventListener('click', generateLocalAIAnalysis);
        }

        function generateLocalAIAnalysis() {
            const container = document.getElementById('ai-analysis-container');
            const pdfCustomization = document.getElementById('pdf-customization-section');
            container.style.display = 'block';
            pdfCustomization.style.display = 'block';
            
            let selectedFactors = [];
            document.querySelectorAll('.simulator-option.selected').forEach(b => {
                selectedFactors.push({
                    text: b.querySelector('span').textContent.trim(),
                    score: parseInt(b.dataset.score),
                    analysis: b.dataset.analysis
                });
            });

            const score = parseInt(document.getElementById('risk-score-text').textContent);
            
            // Lógica para gerar a análise
            let analysis = "A análise do cenário indica que ";
            const riskContributors = selectedFactors.filter(f => f.score > 0).sort((a,b) => b.score - a.score);
            const trustContributors = selectedFactors.filter(f => f.score < 0).sort((a,b) => a.score - b.score);
            
            if (score > 65) {
                analysis += `o risco é <strong>ALTO</strong>. Fatores críticos como '<strong>${riskContributors[0].text}</strong>' e '<strong>${riskContributors[1] ? riskContributors[1].text : 'múltiplos sinais de alerta'}</strong>' se sobrepõem aos indicadores de confiança. A combinação de sinais negativos sugere uma alta probabilidade de atividade fraudulenta.`;
            } else if (score > 35) {
                analysis += `o risco é <strong>MÉDIO</strong>. Embora existam indicadores de confiança como '<strong>${trustContributors[0] ? trustContributors[0].text : 'comportamento normal'}</strong>', a presença de alertas como '<strong>${riskContributors[0].text}</strong>' gera incerteza. A transação não é claramente legítima nem obviamente fraudulenta, exigindo cautela.`;
            } else {
                analysis += `o risco é <strong>BAIXO</strong>. A transação é sustentada por fortes indicadores de confiança, principalmente '<strong>${trustContributors[0].text}</strong>' e '<strong>${trustContributors[1] ? trustContributors[1].text : 'consistência geral'}</strong>'. Os poucos sinais de alerta presentes não são suficientes para indicar uma ameaça real.`;
            }

            let recommendation = "";
            if (score > 70) {
                recommendation = "<strong>Recusa Imediata.</strong> O acúmulo de fatores de risco torna a transação insustentável.";
            } else if (score > 35) {
                recommendation = "<strong>Revisão Manual Urgente.</strong> É necessária uma análise humana para validar os dados e, se possível, contatar o cliente para confirmar a legitimidade da compra.";
            } else {
                recommendation = "<strong>Aprovação Automática.</strong> O perfil da transação é consistente com o de um cliente legítimo e o risco é considerado aceitável.";
            }

            container.innerHTML = `${analysis}<br><br><strong>Recomendação:</strong> ${recommendation}`;
            document.getElementById('export-pdf-button').disabled = false;
        }


        // --- LÓGICA DO TOOLTIP E MODAIS ---
        function setupModals() {
            const modals = [
                { btnId: 'glossary-btn', modalId: 'glossary-modal' },
                { btnId: 'lab-btn', modalId: 'lab-modal' },
                { btnId: 'shield-btn', modalId: 'shield-modal' }
            ];

            modals.forEach(({btnId, modalId}) => {
                const modal = document.getElementById(modalId);
                const btn = document.getElementById(btnId);
                const closeBtn = modal.querySelector('.modal-close-btn');

                btn.addEventListener('click', () => modal.classList.add('visible'));
                closeBtn.addEventListener('click', () => modal.classList.remove('visible'));
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.classList.remove('visible');
                });
            });

            // Initialize content for each modal
            setupGlossaryContent();
            setupLabContent();
            setupShieldContent();
        }
        
        function setupTooltips() {
            const tooltip = document.getElementById('tooltip');
            const tooltipContent = document.getElementById('tooltip-content');
            const tooltipArrow = document.getElementById('tooltip-arrow');
            
            const triggerElements = document.querySelectorAll('.icon-wrapper, .info-icon');

            triggerElements.forEach(element => {
                element.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const description = e.currentTarget.dataset.tooltipText;
                    if (!description) return;
                    
                    if (tooltip.classList.contains('visible') && tooltip.dataset.currentTrigger === e.currentTarget) {
                        tooltip.classList.remove('visible');
                        tooltip.dataset.currentTrigger = null;
                        return;
                    }

                    tooltipContent.innerHTML = description;
                    tooltip.classList.add('visible');
                    tooltip.dataset.currentTrigger = e.currentTarget; 
                    
                    positionTooltip(e.currentTarget);
                });
            });

            window.addEventListener('click', (e) => {
                const trigger = e.target.closest('.icon-wrapper, .info-icon');
                if (!trigger && !e.target.closest('#tooltip')) {
                    tooltip.classList.remove('visible');
                    tooltip.dataset.currentTrigger = null;
                }
            });

            function positionTooltip(triggerElement) {
                if (!tooltip.classList.contains('visible')) return;
                const rect = triggerElement.getBoundingClientRect();
                
                tooltip.style.display = 'block';
                const tooltipRect = tooltip.getBoundingClientRect();
                
                let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                if (left < 10) left = 10;
                if (left + tooltipRect.width > window.innerWidth - 10) {
                    left = window.innerWidth - tooltipRect.width - 10;
                }
                tooltip.style.left = `${left}px`;
                
                if (window.innerHeight - rect.bottom > tooltipRect.height + 15) {
                    tooltip.style.top = `${window.pageYOffset + rect.bottom + 10}px`;
                    tooltipArrow.style.borderTop = 'none';
                    tooltipArrow.style.borderBottom = '8px solid #2d3748';
                    tooltipArrow.style.top = '-8px';
                    tooltipArrow.style.bottom = 'auto';
                } else {
                    tooltip.style.top = `${window.pageYOffset + rect.top - tooltipRect.height - 10}px`;
                    tooltipArrow.style.borderBottom = 'none';
                    tooltipArrow.style.borderTop = '8px solid #2d3748';
                    tooltipArrow.style.bottom = '-8px';
                    tooltipArrow.style.top = 'auto';
                }
            }
        }
        
       // --- LÓGICA DE COMPARAÇÃO DE FERRAMENTAS ---
        function setupComparison() {
            const checkboxes = document.querySelectorAll('.tool-checkbox');
            const compareBtn = document.getElementById('compare-tools-button');

            checkboxes.forEach(cb => {
                cb.addEventListener('change', (e) => {
                    e.target.closest('.tool-item').classList.toggle('selected', e.target.checked);
                    const selected = document.querySelectorAll('.tool-checkbox:checked');
                    compareBtn.disabled = selected.length < 2 || selected.length > 3;
                });
            });

            compareBtn.addEventListener('click', () => {
                const selected = document.querySelectorAll('.tool-checkbox:checked');
                const selectedTools = Array.from(selected).map(s => fraudTools[s.dataset.toolIndex]);
                renderComparisonChart(selectedTools);
                document.getElementById('comparison-section').style.display = 'block';
                document.getElementById('comparison-section').scrollIntoView({ behavior: 'smooth' });
            });
        }
        
        function renderComparisonChart(selectedTools) {
             const ctx = document.getElementById('comparison-radar-chart').getContext('2d');
             const labels = ['Defesa vs Bots', 'vs Fraude Amigável', 'Análise Comportamental', 'Força do Efeito de Rede'];
             const colors = ['rgba(168, 85, 247, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(59, 130, 246, 0.8)'];

             if (comparisonChart) {
                 comparisonChart.destroy();
             }
             
             comparisonChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: selectedTools.map((tool, index) => ({
                        label: tool.name,
                        data: Object.values(tool.comparisonScores),
                        borderColor: colors[index],
                        backgroundColor: colors[index].replace('0.8', '0.2'),
                        borderWidth: 2,
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            min: 0, max: 100, angleLines: { color: 'rgba(75, 85, 99, 0.5)' },
                            grid: { color: 'rgba(75, 85, 99, 0.5)' },
                            pointLabels: { color: 'rgba(209, 213, 219, 0.8)', font: { size: 12 } },
                            ticks: { display: false, stepSize: 20 }
                        }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { color: 'rgba(209, 213, 219, 1)' } },
                    }
                }
            });
        }


        // --- LÓGICA DE EXPORTAÇÃO PARA PDF ---
        function setupExportButton() {
            const button = document.getElementById('export-pdf-button');
            const logoUpload = document.getElementById('logo-upload');
            let logoDataUrl = null;

            logoUpload.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        logoDataUrl = e.target.result;
                        document.getElementById('logo-preview').src = logoDataUrl;
                         document.getElementById('logo-preview').classList.remove('hidden');
                    }
                    reader.readAsDataURL(file);
                }
            });
            
            button.addEventListener('click', () => exportAnalysisToPDF(logoDataUrl));
        }

        async function exportAnalysisToPDF(logoDataUrl) {
            const { jsPDF } = window.jspdf;
            const reportContent = document.getElementById('pdf-export-content');
            const analysisText = document.getElementById('ai-analysis-container').innerHTML;
            const notesText = document.getElementById('pdf-notes').value;
            const signatureText = document.getElementById('page-footer').textContent;
            
            const button = document.getElementById('export-pdf-button');
            button.disabled = true;
            button.textContent = "Gerando...";

            try {
                const canvas = await html2canvas(reportContent, { 
                    backgroundColor: '#1f2937', // Cor de fundo do card
                    scale: 2, 
                });

                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const margin = 15;
                let yPosition = margin;

                // Cabeçalho com Logo
                if (logoDataUrl) {
                     pdf.addImage(logoDataUrl, 'PNG', margin, yPosition, 30, 0, undefined, 'FAST');
                }
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(18);
                pdf.setTextColor('#8B5CF6');
                pdf.text('Relatório de Análise de Risco', pdfWidth - margin, yPosition + 10, { align: 'right' });
                yPosition += 25;

                // Linha divisória
                pdf.setDrawColor(75, 85, 99);
                pdf.setLineWidth(0.5);
                pdf.line(margin, yPosition, pdfWidth - margin, yPosition);
                yPosition += 10;
                
                // Imagem do painel de resultados
                const imgProps = pdf.getImageProperties(imgData);
                const contentWidth = pdfWidth - (margin * 2);
                const imgHeight = (imgProps.height * contentWidth) / imgProps.width;
                pdf.addImage(imgData, 'PNG', margin, yPosition, contentWidth, imgHeight, undefined, 'FAST');
                yPosition += imgHeight + 10;

                // Notas Adicionais
                if (notesText.trim() !== '') {
                    pdf.setFont('helvetica', 'bold');
                    pdf.setFontSize(12);
                    pdf.setTextColor(55, 65, 81);
                    pdf.text('Notas Adicionais', margin, yPosition);
                    yPosition += 6;
                    
                    pdf.setFont('helvetica', 'normal');
                    pdf.setFontSize(10);
                    pdf.setTextColor(107, 114, 128);
                    const splitNotes = pdf.splitTextToSize(notesText, contentWidth);
                    pdf.text(splitNotes, margin, yPosition);
                    yPosition += (splitNotes.length * 5) + 10;
                }

                // Análise e Recomendação
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(12);
                pdf.setTextColor(55, 65, 81);
                pdf.text('Análise e Recomendação', margin, yPosition);
                yPosition += 6;
                
                pdf.setFont('helvetica', 'normal');
                pdf.setFontSize(10);
                pdf.setTextColor(107, 114, 128);
                const splitAnalysis = pdf.splitTextToSize(analysisText.replace(/<br\s*[\/]?>/gi, "\n").replace(/<[^>]*>/g, ''), contentWidth);
                pdf.text(splitAnalysis, margin, yPosition);

                // Rodapé
                const finalY = pdf.internal.pageSize.getHeight() - 10;
                pdf.setFontSize(8);
                pdf.setTextColor(156, 163, 175);
                pdf.text( signatureText, pdfWidth / 2, finalY, { align: 'center' });

                pdf.save('analise_de_risco_dataris.pdf');
                
            } catch (err) {
                console.error("Erro ao gerar PDF:", err);
            } finally {
                button.disabled = false;
                button.textContent = "Exportar Análise";
            }
        }
        
        // --- LÓGICA DO GRAFO DE REDE ---
        function setupNetworkGraph() {
            const svg = document.getElementById('network-svg');
            const container = document.getElementById('network-graph-container');
            const nodes = {
                address: document.getElementById('node-address'),
                device: document.getElementById('node-device'),
                cpf: document.getElementById('node-cpf'),
                email: document.getElementById('node-email'),
                purchase: document.getElementById('node-purchase-attempt'),
                fraud: document.getElementById('node-fraud'),
            };

            const nodeOrder = ['address', 'device', 'cpf', 'email', 'purchase', 'fraud'];

            function getIntersectionPoint(rect, angle) {
                const w = rect.width / 2;
                const h = rect.height / 2;
                const cx = rect.left + w;
                const cy = rect.top + h;

                const tan = Math.tan(angle);
                
                let x, y;
                
                const yOnVertical = h * Math.sign(Math.sin(angle));
                const xAtY = yOnVertical / tan;
                
                const xOnHorizontal = w * Math.sign(Math.cos(angle));
                const yAtX = xOnHorizontal * tan;
                
                if (Math.abs(yAtX) <= h) {
                    x = cx + xOnHorizontal;
                    y = cy + yAtX;
                } else {
                    x = cx + xAtY;
                    y = cy + yOnVertical;
                }
                return { x, y };
            }

            function connect(node1, node2) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                const containerRect = svg.parentElement.getBoundingClientRect();
                
                const rect1 = node1.getBoundingClientRect();
                const rect2 = node2.getBoundingClientRect();

                const center1 = { x: rect1.left + rect1.width / 2, y: rect1.top + rect1.height / 2 };
                const center2 = { x: rect2.left + rect2.width / 2, y: rect2.top + rect2.height / 2 };

                const angle = Math.atan2(center2.y - center1.y, center2.x - center1.x);

                const startPoint = getIntersectionPoint(rect1, angle);
                const endPoint = getIntersectionPoint(rect2, angle + Math.PI);

                line.setAttribute('x1', startPoint.x - containerRect.left);
                line.setAttribute('y1', startPoint.y - containerRect.top);
                line.setAttribute('x2', endPoint.x - containerRect.left);
                line.setAttribute('y2', endPoint.y - containerRect.top);
                
                line.setAttribute('stroke', '#ef4444');
                line.setAttribute('stroke-width', '2');
                line.setAttribute('stroke-dasharray', '6, 4');
                
                const length = Math.sqrt((endPoint.x - startPoint.x)**2 + (endPoint.y - startPoint.y)**2);
                line.style.strokeDasharray = length;
                line.style.strokeDashoffset = length;
                line.style.animation = `drawLine 1s ease-out forwards ${Math.random() * 0.5}s`;

                svg.appendChild(line);
            }
            
            function drawLines() {
                svg.innerHTML = ''; 
                if (!nodes.fraud) return;
                
                for(let i = 0; i < nodeOrder.length - 1; i++){
                    const node1 = nodes[nodeOrder[i]];
                    const node2 = nodes[nodeOrder[i+1]];
                    if(node1 && node2){
                       connect(node1, node2);
                    }
                }
            }
            
            const styleSheet = document.createElement("style");
            styleSheet.type = "text/css";
            styleSheet.innerText = `@keyframes drawLine { to { stroke-dashoffset: 0; } }`;
            document.head.appendChild(styleSheet);
            
            const observer = new IntersectionObserver((entries) => {
                if(entries[0].isIntersecting){
                    setTimeout(() => { 
                        drawLines();
                        window.addEventListener('resize', drawLines);
                    }, 100);
                } else {
                    window.removeEventListener('resize', drawLines);
                }
            }, { threshold: 0.1 });
            
            observer.observe(svg.parentElement);
        }

        function setupGlossaryContent() {
             const listContainer = document.getElementById('glossary-list');
            listContainer.innerHTML = Object.entries(glossaryTerms).map(([term, definition]) => `
                <div>
                    <h4 class="font-bold text-purple-200">${term}</h4>
                    <p class="text-sm text-gray-400">${definition}</p>
                </div>
            `).join('');
        }

        function setupLabContent(){
             const typingInput = document.getElementById('typing-input');
            const typingCtx = document.getElementById('typing-chart').getContext('2d');
            let lastTime = Date.now();
            let typingData = [];

            if (typingChart) typingChart.destroy();
            typingChart = new Chart(typingCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Intervalo (ms)',
                        data: [],
                        borderColor: 'rgba(168, 85, 247, 1)',
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { min: 0, max: 500, ticks: {color: '#9ca3af'} }, x: { ticks: {color: '#9ca3af'} } },
                    plugins: { legend: { display: false } }
                }
            });
            
            typingInput.addEventListener('keydown', () => {
                const now = Date.now();
                const interval = now - lastTime;
                lastTime = now;
                
                if (typingData.length > 20) {
                    typingData.shift();
                    typingChart.data.labels.shift();
                }
                typingData.push(interval);
                typingChart.data.labels.push('');
                typingChart.data.datasets[0].data = typingData;
                typingChart.update();
            });

            const mouseCanvas = document.getElementById('mouse-canvas');
            const mouseCtx = mouseCanvas.getContext('2d');
            let mousePath = [];
            
            function resizeMouseCanvas() {
                mouseCanvas.width = mouseCanvas.parentElement.clientWidth;
                mouseCanvas.height = mouseCanvas.parentElement.clientHeight;
            }
            resizeMouseCanvas();

            mouseCanvas.parentElement.addEventListener('mousemove', (e) => {
                const rect = mouseCanvas.getBoundingClientRect();
                mousePath.push({x: e.clientX - rect.left, y: e.clientY - rect.top});

                mouseCtx.clearRect(0, 0, mouseCanvas.width, mouseCanvas.height);
                mouseCtx.beginPath();
                mouseCtx.moveTo(mousePath[0].x, mousePath[0].y);
                for (let i = 1; i < mousePath.length; i++) {
                    mouseCtx.lineTo(mousePath[i].x, mousePath[i].y);
                }
                mouseCtx.strokeStyle = '#c4b5fd';
                mouseCtx.lineWidth = 2;
                mouseCtx.stroke();
            });
             mouseCanvas.parentElement.addEventListener('mouseleave', () => {
                mousePath = [];
             });

             window.addEventListener('resize', resizeMouseCanvas);
        }
        
         function setupShieldContent() {
            const checklistContainer = document.getElementById('shield-checklist');
            const shieldBar = document.getElementById('shield-bar');
            
            const practices = [
                { id: 'vpn-off', text: 'Evitar uso de VPNs/Proxies', points: 25 },
                { id: 'no-paste', text: 'Digitar dados manualmente (sem colar)', points: 25 },
                { id: 'nav-normal', text: 'Manter navegação fluida e natural', points: 25 },
                { id: 'data-consistent', text: 'Usar dados consistentes (ex: e-mail e telefone principais)', points: 25 }
            ];

            checklistContainer.innerHTML = practices.map(p => `
                <div class="flex justify-between items-center">
                    <span>${p.text}</span>
                    <label class="toggle-switch">
                        <input type="checkbox" class="shield-toggle" data-points="${p.points}">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            `).join('');

            const toggles = document.querySelectorAll('.shield-toggle');
            
            function updateShield() {
                let totalPoints = 0;
                toggles.forEach(t => {
                    if (t.checked) {
                        totalPoints += parseInt(t.dataset.points);
                    }
                });
                shieldBar.style.width = `${totalPoints}%`;
            }
            
            toggles.forEach(t => t.addEventListener('change', updateShield));
            updateShield();
        }
        
        function setupModals() {
            const modals = [
                { btnId: 'glossary-btn', modalId: 'glossary-modal' },
                { btnId: 'lab-btn', modalId: 'lab-modal' },
                { btnId: 'shield-btn', modalId: 'shield-modal' }
            ];

            modals.forEach(({btnId, modalId}) => {
                const modal = document.getElementById(modalId);
                const btn = document.getElementById(btnId);
                const closeBtn = modal.querySelector('.modal-close-btn');

                btn.addEventListener('click', () => modal.classList.add('visible'));
                closeBtn.addEventListener('click', () => modal.classList.remove('visible'));
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.classList.remove('visible');
                });
            });

            setupGlossaryContent();
            setupLabContent();
            setupShieldContent();
        }

    </script>
</body>
</html>
